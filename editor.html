<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆÙ†ØªÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
</head>
<body class="bg-light">

<div class="container mt-4">
  <h3 class="text-center mb-4">ğŸ¬ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆÙ†ØªÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</h3>
  
  <div class="mb-3">
    <label class="form-label">ğŸ“… Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
    <select class="form-select" id="dateSelect" onchange="loadDayData()">
      <option selected disabled>-- Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® --</option>
    </select>
  </div>

  <form id="editorForm" class="d-none">
    <div id="editorList" class="row g-3"></div>
    <div class="text-center mt-4">
      <button type="submit" class="btn btn-success">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©</button>
    </div>
  </form>
</div>

<script>
  const config = {
    apiKey: "AIzaSyBvNRBl3cObiLC7GufXyCnF6BlKLM3oWXw",
    authDomain: "register-app-534bf.firebaseapp.com",
    databaseURL: "https://register-app-534bf-default-rtdb.firebaseio.com",
    projectId: "register-app-534bf",
    projectNumber: "1042312911162"
  };

  firebase.initializeApp(config);
  const db = firebase.database();

  let currentDate = "";
  let entriesArray = [];

  function loadDates() {
    db.ref("attendance").once("value", snapshot => {
      const data = snapshot.val();
      const select = document.getElementById("dateSelect");

      if (!data) return;

      const dates = Object.keys(data).sort().reverse();
      dates.forEach(date => {
        const opt = document.createElement("option");
        opt.value = date;
        opt.textContent = date;
        select.appendChild(opt);
      });
    });
  }

  function loadDayData() {
    currentDate = document.getElementById("dateSelect").value;
    document.getElementById("editorForm").classList.remove("d-none");
    entriesArray = [];

    db.ref(`attendance/${currentDate}`).once("value", snapshot => {
      const data = snapshot.val();
      const container = document.getElementById("editorList");
      container.innerHTML = "";

      if (!data) {
        container.innerHTML = `<p class="text-muted text-center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¶ÙˆØ± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….</p>`;
        return;
      }

   function loadDayData() {
  currentDate = document.getElementById("dateSelect").value;
  document.getElementById("editorForm").classList.remove("d-none");
  entriesArray = [];

  db.ref(`attendance/${currentDate}`).once("value", snapshot => {
    const data = snapshot.val();
    const container = document.getElementById("editorList");
    container.innerHTML = "";

    if (!data) {
      container.innerHTML = `<p class="text-muted text-center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¶ÙˆØ± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….</p>`;
      return;
    }

    Object.entries(data).forEach(([key, entry], index) => {
      entriesArray.push({ key, ...entry });

      db.ref(`editingStatus/${currentDate}/${key}`).once("value", statusSnap => {
        const status = statusSnap.val() || {};
        const col = document.createElement("div");
        col.className = "col-md-6";

        col.innerHTML = `
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title">${entry.name}</h5>
              <p class="card-text">â° Ø¯Ø®ÙˆÙ„: ${entry.timeIn || "-"} - Ø®Ø±ÙˆØ¬: ${entry.timeOut || "-"}</p>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="edited_${index}" ${status.edited ? "checked" : ""}>
                <label class="form-check-label" for="edited_${index}">âœ… ØªÙ…Øª Ø§Ù„Ù…Ù†ØªØ¬Ø©</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="filmed_${index}" ${status.filmed ? "checked" : ""}>
                <label class="form-check-label" for="filmed_${index}">ğŸ¥ ØªÙ… Ø§Ù„ØªØµÙˆÙŠØ±</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="uploaded_${index}" ${status.uploaded ? "checked" : ""}>
                <label class="form-check-label" for="uploaded_${index}">â˜ï¸ ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø­Ù„Ù‚Ø©</label>
              </div>
            </div>
          </div>
        `;

        container.appendChild(col);
      });
    });
  });
}

  }

  document.getElementById("editorForm").addEventListener("submit", (e) => {
    e.preventDefault();

    entriesArray.forEach((entry, index) => {
      const edited = document.getElementById(`edited_${index}`).checked;
      const filmed = document.getElementById(`filmed_${index}`).checked;
      const uploaded = document.getElementById(`uploaded_${index}`).checked;

      db.ref(`editingStatus/${currentDate}/${entry.key}`).set({
        name: entry.name || "",
        timeIn: entry.timeIn || "",
        timeOut: entry.timeOut || "",
        edited,
        filmed,
        uploaded
      });
    });

    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!");
  });

  loadDates();
</script>

</body>
</html>
